
ЁЯзй Syntax 1:
UNIQUE (column_name)

ЁЯзй Syntax 2:
CONSTRAINT uniq_sku_code UNIQUE (column_name)


ржжрзБржЗржЯрж╛ржЗ functional same тАФ ржЕрж░рзНржерж╛рзО ржжрзБржЗржнрж╛ржмрзЗржЗ ржУржЗ column unique рж╣ржмрзЗред
ржХрж┐ржирзНрждрзБ ржорзВрж▓ ржкрж╛рж░рзНржержХрзНржп naming, management, ржПржмржВ maintainability рждрзЗред

ЁЯза ржПржЦржи ржжрзЗржЦрж┐ ржкрж╛рж░рзНржержХрзНржп ржУ ржХрзЗржи Syntax 2 ржжрж░ржХрж╛рж░рж┐:
ЁЯФ╣ 1. Constraint Name ржжрзЗржУрзЯрж╛ ржпрж╛рзЯ (Manageability)

Syntax 1 ржП ржЖржкржирж┐ constraint-ржПрж░ ржХрзЛржирзЛ name ржжрзЗржи ржирж╛, MySQL ржирж┐ржЬрзЗ auto-generated ржПржХржЯрж╛ ржирж╛ржо ржмрж╛ржирж╛рзЯ (ржпрзЗржоржиржГ users_email_unique ржмрж╛ uniq_2398472)ред

ржХрж┐ржирзНрждрзБ ржЖржкржирж┐ ржпржжрж┐ ржнржмрж┐рж╖рзНржпрждрзЗ ржПржЗ constraint drop ржмрж╛ modify ржХрж░рждрзЗ ржЪрж╛ржи, рждржЦржи рж╕рзЗржЗ auto-generated ржирж╛ржо ржЦрзБржБржЬрзЗ ржмрзЗрж░ ржХрж░рж╛ ржЭрж╛ржорзЗрж▓рж╛ рж╣рзЯред

ЁЯЯй Syntax 2 ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж▓рзЗ ржЖржкржирж┐ ржирж┐ржЬрзЗржЗ meaningful ржирж╛ржо ржжрж┐рждрзЗ ржкрж╛рж░рзЗржи, ржпрзЗржоржиржГ

ALTER TABLE products DROP CONSTRAINT uniq_sku_code;


ржПрждрзЗ maintenance ржЕржирзЗржХ рж╕рж╣ржЬ рж╣рзЯред

ЁЯФ╣ 2. Better for Team/Production Level Projects

ржмрзЬ project-ржП ржЕржирзЗржХ constraint ржерж╛ржХрзЗ тАФ ржпрзЗржоржи multiple UNIQUE, FOREIGN KEY, CHECK, ржЗрждрзНржпрж╛ржжрж┐ред
рж╕ржм constraint-ржПрж░ meaningful ржирж╛ржо ржерж╛ржХрж▓рзЗ documentation ржУ debugging рж╕рж╣ржЬ рж╣рзЯред

тЬЕ ржЙржжрж╛рж╣рж░ржг:

CREATE TABLE products (
  id INT AUTO_INCREMENT PRIMARY KEY,
  sku VARCHAR(50),
  name VARCHAR(100),
  CONSTRAINT uniq_sku_code UNIQUE (sku)
);


ЁЯСЙ ржПржЦрж╛ржирзЗ uniq_sku_code ржирж╛ржо ржжрзЗржЦрзЗ ржмрзЛржЭрж╛ ржпрж╛рзЯ ржПржЯрж┐ SKU-ржПрж░ ржЬржирзНржп unique constraintред

ЁЯФ╣ 3. Multiple Column Constraint ржП readability ржмрж╛рзЬрзЗ

ржпржЦржи multiple column-ржПрж░ ржЙржкрж░ unique ржжрж┐рждрзЗ рж╣рзЯ, рждржЦржи constraint ржирж╛ржо ржЫрж╛рзЬрж╛ ржХрзЛржб ржЕржирзЗржХ рж╕ржорзЯ ржЕрж╕рзНржкрж╖рзНржЯ рж╣рзЯрзЗ ржпрж╛рзЯред

тЭМ Less clear:

UNIQUE (first_name, last_name, department_id)


тЬЕ More clear:

CONSTRAINT uniq_emp_name_dept UNIQUE (first_name, last_name, department_id)


ржПржЦржи ржжрзЗржЦрзЗ ржмрзЛржЭрж╛ ржпрж╛рзЯ тАФ ржПржЯрж╛ employee name + department-ржПрж░ ржЬржирзНржп unique ruleред

ЁЯФ╣ 4. Cross-Database Portability (PostgreSQL, Oracle, SQL Server)

ржЕржирзЗржХ database (ржпрзЗржоржи PostgreSQL, Oracle) ржП constraint handle ржХрж░рж╛рж░ рж╕ржорзЯ name specify ржХрж░рж╛ best practiceред
рждрж╛ржЗ ржпржжрж┐ ржЖржкржирж┐ ржнржмрж┐рж╖рзНржпрждрзЗ ржЕржирзНржп RDBMS-ржП migrate ржХрж░рзЗржи, Syntax 2 ржмрзЗрж╢рж┐ compatibleред

ЁЯФ╣ 5. Error message ржЖрж░ржУ readable рж╣рзЯ

ржпржЦржи constraint ржирж╛ржо ржжрзЗржУрзЯрж╛ ржерж╛ржХрзЗ, рждржЦржи duplicate entry рж╣рж▓рзЗ error message-ржП constraint ржирж╛ржоржЯрж┐ ржЖрж╕рзЗред
ржПрждрзЗ debug ржХрж░рж╛ рж╕рж╣ржЬ рж╣рзЯред

ЁЯУН ржЙржжрж╛рж╣рж░ржг:

Without name (syntax 1):

ERROR 1062 (23000): Duplicate entry 'ABC123' for key 'products.sku'


With name (syntax 2):

ERROR 1062 (23000): Duplicate entry 'ABC123' for key 'uniq_sku_code'


ржжрзНржмрж┐рждрзАрзЯржЯрж╛рзЯ error message ржерзЗржХрзЗржЗ ржмрзЛржЭрж╛ ржпрж╛ржЪрзНржЫрзЗ ржХрзЛржи constraint ржнрж╛ржЩрж╛ рж╣рзЯрзЗржЫрзЗред

ЁЯУж рж╕ржВржХрзНрж╖рзЗржкрзЗ рждрзБрж▓ржирж╛:
ржмрж┐рж╖рзЯ	Syntax 1	Syntax 2
Constraint name	Auto-generated	Custom name ржжрзЗржУрзЯрж╛ ржпрж╛рзЯ
Maintainability	ржХржо	ржмрзЗрж╢рж┐
Drop/Alter ржХрж░рж╛	ржЭрж╛ржорзЗрж▓рж╛ржкрзВрж░рзНржг	рж╕рж╣ржЬ
Error message	Unclear	Clear
Team project ржП ржЙржкржпрзБржХрзНржд	ржирж╛	тЬЕ рж╣рзНржпрж╛ржБ
Multiple-column readability	ржХржо	ржмрзЗрж╢рж┐
тЬЕ ржЙржкрж╕ржВрж╣рж╛рж░

ржпржЦржи ржЖржкржирж┐ ржЫрзЛржЯ test ржмрж╛ demo ржЯрзЗржмрж┐рж▓ ржмрж╛ржирж╛ржЪрзНржЫрзЗржи, рждржЦржи syntax 1 ржпржерзЗрж╖рзНржЯред
ржХрж┐ржирзНрждрзБ production-level database design ржмрж╛ team project ржП рж╕ржмрж╕ржорзЯ ржПржЗржнрж╛ржмрзЗ рж▓рж┐ржЦрж╛ржЗ рж╕рзЗрж░рж╛ practice:

CONSTRAINT uniq_sku_code UNIQUE (sku)


ржХрж╛рж░ржг ржПрждрзЗ ржЖржкржирж╛рж░ database structure рж╣рзЯ readable, maintainable, ржПржмржВ professional-gradeред




Problem:

ржПржХржЯрж┐ ржкрзНрж░рзЛржбрж╛ржХрзНржЯ ржжрзАрж░рзНржШржжрж┐ржи ржзрж░рзЗ ржмрж┐ржХрзНрж░рж┐ рж╣ржЪрзНржЫрзЗ ржПржмржВ рждрж╛рж░ ржПржХржЯрж┐ SKU (Stock Keeping Unit) рж░рзЯрзЗржЫрзЗред ржПржЦржи рж╕рзЗржЗ ржкрзНрж░рзЛржбрж╛ржХрзНржЯржЯрж┐ ржмрж┐ржХрзНрж░рж┐ ржмржирзНржз ржХрж░рж╛рж░ рж╕рж┐ржжрзНржзрж╛ржирзНржд ржирзЗржУрзЯрж╛ рж╣рж▓рзЛред рж╕рж╛ржзрж╛рж░ржгржд SKU unique рж░рж╛ржЦрждрзЗ рж╣рзЯ, ржХрж┐ржирзНрждрзБ ржнржмрж┐рж╖рзНржпрждрзЗ ржпржжрж┐ ржПржХржЗ SKU-рж░ ржкрзНрж░рзЛржбрж╛ржХрзНржЯ ржЖржмрж╛рж░ ржЪрж╛рж▓рзБ ржХрж░рж╛ рж╣рзЯ, рждрж╛рж╣рж▓рзЗ ржкрзБрж░рзЛржирзЛ ржкрзНрж░рзЛржбрж╛ржХрзНржЯрзЗрж░ ржХрж╛рж░ржгрзЗ ржирждрзБржи ржкрзНрж░рзЛржбрж╛ржХрзНржЯ insert ржХрж░рждрзЗ ржЧрзЗрж▓рзЗ unique constraint violation рж╣рждрзЗ ржкрж╛рж░рзЗред

тЬЕ Solution:

ржПржЗ рж╕ржорж╕рзНржпрж╛рж░ рж╕ржорж╛ржзрж╛ржи рж╣рж▓рзЛ тАФ SKU-ржПрж░ uniqueness рж╢рзБржзрзБ SKU ржХрж▓рж╛ржорзЗрж░ ржЙржкрж░ ржирж╛ рж░рзЗржЦрзЗ, рждрж╛рж░ рж╕ржЩрзНржЧрзЗ deleted_at ржХрж▓рж╛ржоржХрзЗржУ ржпрзБржХрзНржд ржХрж░рж╛ред ржЕрж░рзНржерж╛рзО, constraint ржЯрж╛ ржПржнрж╛ржмрзЗ declare ржХрж░рж╛ рж╣ржмрзЗ:

CONSTRAINT uniq_sku_code UNIQUE (sku, deleted_at)


ржПрждрзЗ ржХрж░рзЗ ржпржЦржи ржХрзЛржирзЛ ржкрзНрж░рзЛржбрж╛ржХрзНржЯ inactive ржмрж╛ deleted рж╣рзЯ (ржЕрж░рзНржерж╛рзО deleted_at ржХрж▓рж╛ржорзЗ ржХрзЛржирзЛ ржорж╛ржи рж╕рзЗржЯ ржХрж░рж╛ рж╣рзЯ), рждржЦржи рж╕рзЗржЗ рж░рзЗржХрж░рзНржбржЯрж┐ ржЖрж░ рж╕ржХрзНрж░рж┐рзЯ ржкрзНрж░рзЛржбрж╛ржХрзНржЯрзЗрж░ ржорждрзЛ ржЧржгрзНржп рж╣ржмрзЗ ржирж╛ред ржлрж▓рзЗ ржкрж░ржмрж░рзНрждрзАрждрзЗ ржпржжрж┐ ржПржХржЗ SKU ржирж┐рзЯрзЗ ржирждрзБржи ржкрзНрж░рзЛржбрж╛ржХрзНржЯ insert ржХрж░рж╛ рж╣рзЯ, рждрж╛рждрзЗ uniqueness constraint ржнрж╛ржЩржмрзЗ ржирж╛ред

ржПржЗржнрж╛ржмрзЗ SKU-ржПрж░ uniqueness ржХрзЗржмрж▓ржорж╛рждрзНрж░ active ржкрзНрж░рзЛржбрж╛ржХрзНржЯржЧрзБрж▓рзЛрж░ ржоржзрзНржпрзЗ ржмржЬрж╛рзЯ ржерж╛ржХрзЗ, ржпрж╛ practical business scenario ржЕржирзБржпрж╛рзЯрзА ржЕржирзЗржХ ржмрзЗрж╢рж┐ ржпрзБржХрзНрждрж┐рж╕ржЩрзНржЧржд ржУ flexible рж╕ржорж╛ржзрж╛ржиред


